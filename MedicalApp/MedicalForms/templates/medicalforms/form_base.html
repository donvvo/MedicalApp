{% extends "base.html" %}
{% load has_group %}

{% block content %}

<form class="validator-form" action="{{request.path}}" method="post" accept-charset="utf-8">
  {% csrf_token %}

  <section class="profile-doctor generic animated fadeInUp">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="section-title">
            <h3>{% block title %}{% endblock title %}</h3>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
          <div class="row">
            <div class="col-sm-6 col-sm-offset-6 text-right">
              Patient Name: {{object.patient}}
            </div>
            <div class="col-sm-6 col-sm-offset-6 text-right">
              Last Modified: {{object.last_modified}}
            </div>
          </div>
          <br>

          {{form.submitted}}

          {% block form_content %}
          {% endblock form_content %}

          <br>
          <div class="pull-right">
            <a href="{% url 'users:patient_profile' object.patient.user.pk %}" class="btn btn-default btn-color-border-solid">Back</a>
            {% if not object.submitted and not user|has_group:"Patients" %}
            <input type="submit" class="btn btn-default btn-color-border-solid" value="Submit">
            {% elif not object.submitted and user|has_group:"Patients" %}
            <a class="btn btn-default btn-color-border-solid" data-toggle="modal" data-target="#patientConfirmModal">
              Submit
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

  {% if not object.submitted and user|has_group:"Patients" %}
  <!-- Modal -->
  <div class="modal fade" id="patientConfirmModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Do you wish to submit this form?</h4>
        </div>
        <div class="modal-body">
          Are you sure you want to submit? Once submitted, this form cannot be modified.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Return</button>
          <input type="submit" class="btn btn-color-bg" value="Submit">
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</form>

{% endblock %}

{% block javascript %}

{{block.super}}

<script>
{% if object.submitted and user|has_group:"Patients" %}
$('.validator-form :input').prop("disabled", true);
{% endif %}
</script>

{% endblock %}
