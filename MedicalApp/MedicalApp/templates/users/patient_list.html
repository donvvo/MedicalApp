{% extends "base.html" %}
{% load static %}

{% block content %}


<!-- All Doctors -->
    <section class="generic animated fadeInUp">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <div class="section-title">
                        <h3>Meet the Patients</h3>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2">
                    <div class="form-inline" style="float:left;">
                        <label for="sortby">Sort by Last Name:
                            <select class="form-control filter sort-patient" name="sortby" id="id_sortby">
                                <option value="asc">A - Z</option>
                                <option value="desc">Z - A</option>
                            </select>
                        </label>
                    </div>
                    <div class="form-inline" style="float:right;">
                        <input id="search-txt" type="text" placeholder="Search Patients">
                        <button id="search-btn">Search</button>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2">
                  <ul id="patient-list-container" class="media-list">
                    {% if object_list %}
                    {% for patient in object_list %}
                    <li class="media list-group-item patient-list" data-name="{{patient}}" data-email="{{patient.user.email}}" data-phone="{{patient.user.contact}}">
                      <a href="{% url 'users:patient_profile' patient.user.pk %}">
                        <div class="col-xs-3">
                          <figure>
                            {% if patient.user.image %}
                            <img class="media-object img-circle" src="{{patient.user.image.url}}" alt="//">
                            {% else %}
                            <img class="media-object img-circle" src="{% static 'img/profile-img.png' %}" alt="//">
                            {% endif %}
                          </figure>
                        </div>
                        <div class="col-xs-9">
                          <div class="col-sm-4">
                            <h6>Name</h6>
                            <p>{{patient}}</p>
                          </div>
                          <div class="col-sm-4">
                            <h6>Phone</h6>
                            <p>{% if patient.user.contact %}
                              {{patient.user.contact}}
                              {% else %}
                              N/A
                              {% endif %}</p>
                          </div>
                          <div class="col-sm-4">
                            <h6>Clinic</h6>
                            <p>{% if patient.clinic %}
                              {{patient.clinic}}
                              {% else %}
                              N/A
                              {% endif %}</p>
                          </div>
                        </div>
                      </a>
                    </li>
                    {% endfor %}
                    {% else %}
                    <p>Currently there is no patient</p>
                    {% endif %}
                  </ul>
                    <br>
                    <a href="{% url 'users:manage_main' %}" class="btn btn-default btn-color-border-solid">Back</a>
                </div>
            </div>
        </div>
    </section>
    <!-- End All Doctors -->

{% endblock content %}

{% block javascript %}

{{block.super}}

<script>
$(function() {
    var $patientList = $('.patient-list');
    var $listContainer = $('#patient-list-container');

    $('select.sort-patient').change(function() {
        var sortedList;

        var selectVal = $('select.sort-patient option:selected').val();
        if (selectVal === 'asc') {
            sortedList = $patientList.sort(acsSort);
        }
        else {
            sortedList = $patientList.sort(descSort);
        }

        $listContainer.children().remove();
        $listContainer.append(sortedList);
    });

    $('#search-txt').keypress(function (e) {
        if (e.which == 13) {
            $('#search-btn').click();
            return false;    //<---- Add this line
        }
    });
    $('#search-btn').click(function() {
        var searchTxt = $('#search-txt').val();

        var name;
        $patientList.toArray().forEach(function(patient) {
            name = patient.getAttribute('data-name');
            email = patient.getAttribute('data-email');
            phone = patient.getAttribute('data-phone');
            if (name.search(searchTxt) === -1 && email.search(searchTxt) === -1 &&
                phone.search(searchTxt) === -1) {
                patient.style.display = "none";
            }
            else {
                patient.style.display = "block";
            }
        });
    });
});
</script>

{% endblock javascript %}
